{% extends "base.html" %}

{% block content %}
<!-- Search Header -->
<div class="text-center mb-10">
    <h1 class="text-4xl font-extrabold text-gray-900 mb-4">Tìm Đồ Thất Lạc <span class="text-orange-600">FPTU</span>
    </h1>
    <p class="text-gray-600 mb-8">Kết nối cộng đồng, tìm lại đồ đã mất nhanh chóng.</p>

    <form action="{{ url_for('posts_view.index') }}" method="GET"
        class="max-w-xl mx-auto flex shadow-md rounded-lg overflow-hidden">
        <input type="text" name="q" value="{{ query if query else '' }}"
            placeholder="Tìm kiếm (Chìa khóa, ví, thẻ xe...)"
            class="flex-grow px-6 py-3 border-none focus:outline-none">
        <button type="submit" class="bg-orange-600 text-white px-6 font-bold hover:bg-orange-700 transition">
            <i class="fas fa-search"></i>
        </button>
    </form>
</div>

<!-- Items Grid -->
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
    {% for item in items %}
    <div onclick="openDetailModal({{ item.id }})"
        class="bg-white rounded-xl shadow hover:shadow-xl transition duration-300 overflow-hidden relative border border-gray-100 flex flex-col cursor-pointer transform hover:-translate-y-1">

        <!-- Image Thumbnail (Optional - if main image exists) -->
        {% if item.image_url %}
        <div class="h-48 w-full overflow-hidden bg-gray-100 relative group">
            <img src="{{ url_for('static', filename=item.image_url) }}"
                class="w-full h-full object-cover transition duration-500 group-hover:scale-110">
            <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-10 transition duration-300"></div>
        </div>
        {% endif %}

        <div class="p-6 flex-grow">
            <div class="flex justify-between items-start mb-4">
                <span
                    class="inline-block px-3 py-1 rounded-full text-xs font-semibold shadow-sm
                    {% if item.item_type == 'Lost' %} bg-red-100 text-red-600 border border-red-200 {% else %} bg-green-100 text-green-600 border border-green-200 {% endif %}">
                    {{ 'Mất đồ' if item.item_type == 'Lost' else 'Nhặt được' }}
                </span>
                <span class="text-gray-400 text-xs font-mono"><i class="far fa-clock mr-1"></i> {{
                    item.date_posted.strftime('%d/%m %H:%M') }}</span>
            </div>

            <h3 class="text-xl font-bold text-gray-800 mb-2 truncate hover:text-orange-600 transition">{{ item.title }}
            </h3>
            <p class="text-gray-600 text-sm mb-4 line-clamp-2">{{ item.description }}</p>

            <div class="flex items-center text-gray-500 text-sm mb-4">
                <i class="fas fa-map-marker-alt text-orange-500 mr-2"></i> {{ item.location }}
            </div>
        </div>

        <div class="px-6 py-4 bg-gray-50 border-t flex justify-between items-center text-sm">
            <div class="flex items-center space-x-2">
                <div
                    class="w-8 h-8 rounded-full bg-white flex items-center justify-center text-gray-600 font-bold border border-gray-200 shadow-sm text-xs">
                    {{ item.user.username[0].upper() }}
                </div>
                <span class="font-medium text-gray-700 truncate max-w-[100px]">{{ item.user.username }}</span>
            </div>

            <span class="text-orange-600 group-hover:text-orange-700 font-bold">
                Xem chi tiết <i class="fas fa-arrow-right ml-1 transform group-hover:translate-x-1 transition"></i>
            </span>
        </div>
    </div>
    {% else %}
    <div class="col-span-full text-center py-12">
        <div class="bg-gray-100 rounded-full h-24 w-24 flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-search text-gray-400 text-4xl"></i>
        </div>
        <h3 class="text-xl font-bold text-gray-900 mb-2">Chưa tìm thấy tin nào</h3>
        <p class="text-gray-500 mb-6">Hãy thử tìm kiếm từ khóa khác hoặc đăng tin mới.</p>
        <button onclick="openCreateModal()"
            class="px-8 py-3 bg-orange-600 text-white rounded-lg font-bold hover:bg-orange-700 transition shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
            <i class="fas fa-plus mr-2"></i>Đăng tin ngay
        </button>
    </div>
    {% endfor %}
</div>

<!-- Include Detail Modal -->
{% include 'posts/detail_modal.html' %}

{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Check for new post ID to open modal automatically
        const urlParams = new URLSearchParams(window.location.search);
        const newPostId = urlParams.get('new_post_id');
        if (newPostId) {
            openDetailModal(newPostId);
            // Remove param from URL cleanly
            const newUrl = window.location.protocol + "//" + window.location.host + window.location.pathname;
            window.history.pushState({ path: newUrl }, '', newUrl);
        }
    });
</script>
{% endblock %}